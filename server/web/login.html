<!DOCTYPE HTML>
<html>
    <head>   	
	<meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no">  	
	<meta http-equiv="Content-type" content="text/html; charset=utf-8"> 
	<title>Login SmartServer</title> 
	<link rel="stylesheet" href="static/css/bootstrap.css">
	<link rel="stylesheet" href="static/css/bootstrap-responsive.css">
	<link rel="stylesheet" href="static/css/style.css">
        <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
        <!--[if lt IE 9]>
            <script src="static/js/html5.js"></script>
        <![endif]-->        

	<script type="text/javascript" src="static/js/jquery-1.7.2.min.js"></script>
	<script type="text/javascript" src="static/js/jquery.cookie.js"></script>
	<script type="text/javascript" src="static/js/md5.js"></script>
	<script type="text/javascript" src="static/js/json2.js"></script>	
        <script type="text/javascript" src="static/js/util.js"></script> 
	<script type="text/javascript">	
             $(function(){
			$('input.inputText').bind("blur",function(event){
				if($(this).val()){
					$(this).next().text("").hide();
					$(this).css({"background":"#fff"},{"border":"1px solid #ccc"});
				}
			}); 
			$('#password').hide();
			$('#userId').hide();	
	        document.getElementById("textuserId").value = "Input UserId";	
	        document.getElementById("textpassword").value = "Input Password";
             })
	     						
	    function callback(data) {
                ret = data["results"];
                if (ret !== undefined && ret["token"] !== undefined) {
                    $.cookie('ticket', ret["token"], { expires: 7 });
                    $.cookie('loginname', $('#userId').val(), { expires: 7 });
                    window.location = "index.html";
	        } else {
				$('#password').css({"background":"#FFAFAF"},{"border":"1px solid #ccc"});
				$('#spanPass').text("Incorrect password!").show();
				expect = verify();
			}
	    }

        function verifyFields() {

            if($('#userId').val() == ""){
                $('#userId').css({"background":"#FFAFAF"},{"border":"1px solid #ccc"});
                $('#spanuserId').text('Input UserId').show();
                return false;
            }

			if($('#password').val() == ""){
				$('#password').css({"background":"#FFAFAF"},{"border":"1px solid #ccc"});
				$('#spanPass').text('Input Password').show();
				return false;
			}			

			return true;
		}

		function login() {
            if (!verifyFields()) return false;

			var password = $('#password').val();
			var md5password = hex_md5(password);
            $.cookie('password', md5password, { expires: 7 });
			invokeWebApi("/user/auth", {"appid":"01","username": $('#userId').val(), "password": md5password}, callback)
		}

        function quickuserIdRegCall(data) {
            var ret = data["errors"];
            if(ret !== undefined ) {
                alert(ret["msg"]);
            }else alert("Register account successfully!");
        }

		function quickRegister() {
            if (!verifyFields()) return false;
            password = $('#password').val();
            invokeWebApi("/user/register",
                         {
                          "username":$('#userId').val(),
                          "password": password,
                          "appid":"01",
                          "info":{"phone":"N/A","email":"N/A","company":"N/A"}
                         },
                          quickuserIdRegCall
                        );
		}

        function onKeyPressed(ev)
        {
            if (ev.keyCode == 13) login();
        }

        function onuserIdfocus(){
            var value = $('#textuserId').val();
            if(value != "Input UserId")
                return;
            $('#textuserId').hide();
            $('#userId').show();	
            $('#userId').focus();
		}

		function onuserIdblur(){
			var value = $('#userId').val();
			if(value!= "") return;
			$('#textuserId').show();
			$('#userId').hide();	
				
		}

        function ontextpwdfocus(){
            var value = $('#textpassword').val();			
            if(value != 'Input Password') 
                return;
            $('#textpassword').hide();
            $('#password').show();	
            $('#password').focus();
        }		

		function onpwdblur(){
			var value = $('#password').val();
			if(value != "") return;
			$('#textpassword').show();
			$('#password').hide();					
		}
	</script>
  </head> 
  
  <body>

    <header>
        <div class="sfContentBlock">
            <h2>SmartServer</h2>
       </div>
   </header>

  <div id="main" >
	<table align="center">
		<tr>
			<td align=right><div class='span6 hideOnPhone' style='margin-top:60px'><img src='static/img/login.jpg' title='Faster,Higher,Stronger.'></div></td>
			<td><div class='span5' style='margin-top:20px' align=center>
				<input tabindex="0" type="text" style='height:42px' id="textuserId" onfocus="onuserIdfocus()" />
				<input type="text" style='height:42px' id="userId" name="username" class="inputText" onkeyup="onKeyPressed(event)" onblur="onuserIdblur()"/>
				<P><span id='spanuserId' style='display:none'></span></P>
				<P></P>
				
				<input tabindex="0" type="text" style='height:42px' id="textpassword" onfocus="ontextpwdfocus()"/>
				<input tabindex="1" type="password" style='height:42px' id="password" name="password" onkeyup="onKeyPressed(event)" onblur="onpwdblur()"/>
				<P><span id='spanPass' style='display:none '></span></P>
				<P></P>				
					
				<div>
					<div tabindex="2" type="button" id='inputLogin' class="btn btn-primary btn-large" onclick="login()" onkeyup="onKeyPressed(event)"> Login</div>
					&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
					<div tabindex="3" type="button" id='inputRegister' class="btn btn-primary btn-large" onclick="quickRegister()">Register</div>
				</div>

				<div>
				    <a href="static/runner.tar.gz">Download smartRunner</a>
                                    <span>|</span>
                                    <a href="mailto:chengtao.liu@borqs.com" id='aContact'>Contact us</a>
			        </div>
			</div>
			</td>
		</tr>
	</table>
  </div>


    <footer>
	    <table align="center" style="border: none">
		       <tr align="center">
		    	    <td>
		    		    <address>Copyright &copy; 2007-2012 Borqs.co</address>
	                </td>
	          </tr>
	    </table>             	       	
	</footer>
</body>

</html>
